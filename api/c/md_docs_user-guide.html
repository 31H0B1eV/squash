<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>Squash: User Guide</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">Squash
   &#160;<span id="projectnumber">0.0.1</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Data Structures</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">User Guide </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>While the Squash API is fairly large, in general you will only need a handful of functions.</p>
<p>Squash's API follows some pretty standard conventions:</p>
<ul>
<li>Type names are CamelCase (with the first letter uppercase)</li>
<li>Functions are lowercase_with_underscores</li>
<li>Binary data is two variables—a <code>uint8_t*</code> and a <code>size_t</code>.</li>
<li>Instance arguments come first, followed by any output arguments, followed by input arguments.</li>
</ul>
<p>The heart of Squash is the <a class="el" href="group__SquashCodec.html">codec</a>. A codec is an implementation of an algorithm, and codecs with the same name are assumed to be compatible. A single <a class="el" href="group__SquashPlugin.html">plugin</a> can, and often does, provide an implementation of several different codecs.</p>
<p>Typically you will not deal with <a class="el" href="group__SquashContext.html">contexts</a> or plugins directly, and you may only deal with strings to represent codecs.</p>
<h1><a class="anchor" id="buffers"></a>
Buffer API</h1>
<p>If you have a block of data in memory which you want to compress (or decompress), the easiest way to do so is using the buffer API.</p>
<div class="fragment"><div class="line">SquashStatus</div>
<div class="line"><a class="code" href="group__SquashCodec.html#ga99b7aa198ed99ac7a39ad6fb6a7a00ef">squash_compress</a> (<span class="keyword">const</span> <span class="keywordtype">char</span>* codec,</div>
<div class="line">                 uint8_t* compressed, <span class="keywordtype">size_t</span>* compressed_length,</div>
<div class="line">                 <span class="keyword">const</span> uint8_t* uncompressed, <span class="keywordtype">size_t</span> uncompressed_length, ...);</div>
</div><!-- fragment --><p>Like many functions in Squash, <a class="el" href="group__SquashCodec.html#ga99b7aa198ed99ac7a39ad6fb6a7a00ef" title="Compress a buffer. ">squash_compress</a> returns a <a class="el" href="group__SquashStatus.html">SquashStatus</a>. If the operation was successful, a positive number is returned (generally <a class="el" href="group__SquashStatus.html#gga67a659c25084b46746832f31fd7e0db4ad2b378ce34d12d3b6e9cd7e85a83158a" title="Operation completed successfully. ">SQUASH_OK</a>), and a negative number is returned on failure.</p>
<p>The first argument is the name of the codec.</p>
<p>The <em>compressed</em> and <em>compressed_length</em> arguments represent the buffer which you wish to compress the data into. Notice that <em>compressed_length</em> is a <code>size_t*</code>, not a <code>size_t</code>. When you call the function it should be a pointer to the number of bytes available for writing in the compressed buffer, and the function will alter the value to the true size of the compressed data upon successful compression.</p>
<p><em>uncompressed</em> and <em>uncompressed_length</em> are the buffer you wish to compress. <em>uncompressed_length</em> is a <code>size_t</code>, not a <code>size_t</code>, because the function does not need to modify the value.</p>
<p>Finally, this function is variadic—it accepts an arbitrary number of options, which you can use to control things like the compression level. Options are key/value pairs of strings, terminated by a <em>NULL</em> sentinel… More on that later, but for now, just know that passing <em>NULL</em> there will use the defaults, which is generally what you want.</p>
<p>Knowing how big the <em>compressed</em> buffer needs to be generally requires another function:</p>
<div class="fragment"><div class="line"><span class="keywordtype">size_t</span></div>
<div class="line"><a class="code" href="group__SquashCodec.html#gad1c3caa5c734fd8f67dded90dbd854ac">squash_get_max_compressed_size</a> (<span class="keyword">const</span> <span class="keywordtype">char</span>* codec, <span class="keywordtype">size_t</span> uncompressed_length);</div>
</div><!-- fragment --><p>This function returns the maximum buffer size necessary to hold <em>uncompressed_length</em> worth of compressed data, even in the worst case scenario (uncompressable data). Typically it is slightly larger than <em>uncompressed_length</em>.</p>
<p>So, if you wanted to compress some data using the deflate algorithm, you end up with something like this:</p>
<div class="fragment"><div class="line"><span class="keyword">const</span> <span class="keywordtype">char</span>* uncompressed = <span class="stringliteral">&quot;Hello, world!&quot;</span>;</div>
<div class="line"><span class="keywordtype">size_t</span> uncompressed_length = strlen (uncompressed);</div>
<div class="line"><span class="keywordtype">size_t</span> compressed_length = <a class="code" href="group__SquashCodec.html#gad1c3caa5c734fd8f67dded90dbd854ac">squash_get_max_compressed_size</a> (<span class="stringliteral">&quot;deflate&quot;</span>, uncompressed_length);</div>
<div class="line">uint8_t* compressed = (uint8_t*) malloc (compressed_length);</div>
<div class="line"></div>
<div class="line">SquashStatus res =</div>
<div class="line">  <a class="code" href="group__SquashCodec.html#ga99b7aa198ed99ac7a39ad6fb6a7a00ef">squash_compress</a> (<span class="stringliteral">&quot;deflate&quot;</span>, </div>
<div class="line">                   compressed, &amp;compressed_length,</div>
<div class="line">                   (<span class="keyword">const</span> uint8_t*) uncompressed, uncompressed_length,</div>
<div class="line">                   NULL);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span> (res != <a class="code" href="group__SquashStatus.html#gga67a659c25084b46746832f31fd7e0db4ad2b378ce34d12d3b6e9cd7e85a83158a">SQUASH_OK</a>) {</div>
<div class="line">  fprintf (stderr, <span class="stringliteral">&quot;Unable to compress data [%d]: %s\n&quot;</span>,</div>
<div class="line">           res, <a class="code" href="group__SquashStatus.html#gae4874f7346b8f0c44289a2fc4928ca22">squash_status_to_string</a> (res));</div>
<div class="line">  exit (res);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">fprintf (stdout, <span class="stringliteral">&quot;Compressed a %lu byte buffer to %lu bytes.\n&quot;</span>,</div>
<div class="line">         uncompressed_length, compressed_length);</div>
</div><!-- fragment --><p>Decompression is basically the same:</p>
<div class="fragment"><div class="line"><span class="keywordtype">size_t</span> decompressed_length = uncompressed_length + 1;</div>
<div class="line"><span class="keywordtype">char</span>* decompressed = (<span class="keywordtype">char</span>*) malloc (uncompressed_length + 1);</div>
<div class="line"></div>
<div class="line">res = <a class="code" href="group__SquashCodec.html#gab1877550d1c2b82e745943bd8fba14b6">squash_decompress</a> (<span class="stringliteral">&quot;deflate&quot;</span>,</div>
<div class="line">                         (uint8_t*) decompressed, &amp;decompressed_length,</div>
<div class="line">                         compressed, compressed_length, NULL);</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span> (res != <a class="code" href="group__SquashStatus.html#gga67a659c25084b46746832f31fd7e0db4ad2b378ce34d12d3b6e9cd7e85a83158a">SQUASH_OK</a>) {</div>
<div class="line">  fprintf (stderr, <span class="stringliteral">&quot;Unable to decompress data [%d]: %s\n&quot;</span>,</div>
<div class="line">           res, <a class="code" href="group__SquashStatus.html#gae4874f7346b8f0c44289a2fc4928ca22">squash_status_to_string</a> (res));</div>
<div class="line">  exit (res);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="comment">/* Notice that we didn&#39;t compress the *NULL* byte at the end of the</span></div>
<div class="line"><span class="comment">   string.  We could have, it&#39;s just a waste to do so. */</span></div>
<div class="line">decompressed[decompressed_length] = <span class="charliteral">&#39;\0&#39;</span>;</div>
<div class="line"></div>
<div class="line"><span class="keywordflow">if</span> (strcmp (decompressed, uncompressed) != 0) {</div>
<div class="line">  fprintf (stderr, <span class="stringliteral">&quot;Bad decompressed data.\n&quot;</span>);</div>
<div class="line">  exit (-1);</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line">fprintf (stdout, <span class="stringliteral">&quot;Successfully decompressed.\n&quot;</span>);</div>
</div><!-- fragment --><p>It is worth noting that "Hello, world!" is really too short to compress (it "compresses" from 13 bytes to 15 bytes here), but using a longer string will yield better results. You can find a complete, self-contained example in <a class="el" href="simple_8c-example.html">simple.c</a>.</p>
<h1><a class="anchor" id="streams"></a>
Stream API</h1>
<p>While the buffer API is very easy to use, if you want to compress a lot of data without loading it into memory then the stream API is much more appropriate.</p>
<p>If you've ever worked with a compression API in the past then the stream API will probably feel pretty familiar to you. The basic idea is that you have a data structure, a <a class="el" href="group__SquashStream.html">SquashStream</a>, and you shuttle data into one buffer and out of another. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
